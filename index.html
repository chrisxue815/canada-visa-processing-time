<!doctype html>
<html lang="en">
<head>

<title>Canada visa processing time</title>
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
#app table {
    border-collapse: collapse;
}

#app table, #app td {
    border: 1px solid black;
}

#app td {
    padding: 5px 20px;
}

#app div {
    margin: 20px 10px;
}
</style>

</head>

<body>

<div id="app">
    <div>
        <table>
            <tr>
                <td>Visa Type</td>
                <td>{{ type }}</td>
            </tr>
            <tr>
                <td>Country</td>
                <td>{{ countryName }}</td>
            </tr>
            <tr>
                <td>Processing Time</td>
                <td><strong>{{ time }}</strong></td>
            </tr>
            <tr>
                <td>Last Updated</td>
                <td>{{ lastUpdated }}</td>
            </tr>
        </table>
    </div>
    <div>
        <a href="https://github.com/chrisxue815/canada-visa-processing-time">README</a>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/vue"></script>

<script>

async function main() {
    const timesResp = await fetch('https://www.canada.ca/content/dam/ircc/documents/json/data-ptime-en.json');
    const times = await timesResp.json();

    const countryNamesResp = await fetch('https://www.canada.ca/content/dam/ircc/documents/json/data-country-name-en.json');
    const countryNames = await countryNamesResp.json();

    const url = new URL(location.href);
    const type = url.searchParams.get('type');
    const country = url.searchParams.get('country');
    const countryName = countryNames['country-name'] && countryNames['country-name'][country];
    const time = times[type] && times[type][country];
    const lastUpdated = times[type] && times[type]['lastupdated'];

    const app = new Vue({
        el: '#app',
        data: {
            type,
            countryName,
            time,
            lastUpdated,
        },
    });
}

main();

</script>

</body>
</html>
